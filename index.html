<html>
	<head>
		<script src="sha1.js"></script>
		<script>
			(function(){
				window.onload = () => {
					console.log("window loaded!");
					let input = document.querySelector("#inputbar");
					let birthDate = document.querySelector("#birthdatepicker")
					input.focus();

					let resultField = document.querySelector("#resultfield");

					input.addEventListener('keydown', (event) => {
						if(event.keyCode == 13){
							generateID();
						}
					});

					let button = document.querySelector("#generateButton");
					button.addEventListener('click', () => {
						console.log("button clicked");
						generateID();
					});

					function generateID(){
						if(input.value && input.value.trim() && birthDate.value){
							let xhr = new XMLHttpRequest()
							xhr.open("POST", "https://cio.cs.au.dk/CIOIDS/post",true)
							xhr.setRequestHeader("Content-type", "application/json");
							//xhr.setRequestHeader("Access-Control-Allow-Origin", "http://localhost:3000")

							//trim any leading or trailing whitespace (can otherwise be counted as a word by the split() function)
							let trimmed_input = input.value.trim()

							//remove middle names by extracting the very first and very last name
                            let split_name = trimmed_input.split(" ")
							let number_of_names = split_name.length

							//for "backwards compatibility" with participants from 2018 studies
							let trimmed_NAME = split_name[0] + " " + split_name[number_of_names-1]

							let message = "{\"namestring\":\""+trimmed_NAME+"\",\"datestring\":\""+ birthDate.value +"\"}"

							console.log(message)

							xhr.send(message)

							xhr.onreadystatechange = (e) => {
								if(xhr.readyState == 4 && xhr.status == 200){
									let response = JSON.parse(xhr.responseText)
									console.log(response)
									resultField.innerHTML = response.cioid
								}
							}


							//let modifiedString = input.value.replace(/\s/g, "").toLowerCase();
							//resultField.innerHTML = sha1(modifiedString + "salt"); //it's a joke :)
						} else if (birthDate.value) {
							resultField.innerHTML = "Please enter your name!";
						} else if (input.value && input.value.trim()){
							resultField.innerHTML = "Please enter your birthday!";
						} else {
							resultField.innerHTML = "Please enter your name and birthday!";
						}
					}
				}
			})();
		
		</script>
		<style>
			body{
	    		background:white;
				font-family: "Helvetica", Sans-serif;
				text-align: center;
				margin:0px auto;
			}

			#wrap {
				border-radius:5px;
				margin:100px auto;
				width:450px;
				height:auto;
				background: #061566;
				color:white;
				padding:40px;
				box-shadow:5px 5px 5px grey;
				border:2px solid #6075e1;
				padding:40px;
			}

			#inputbar {
				margin:50px 0px 20px 0px;
				border-radius: 2px;
				padding:5px;
				width: 100%;
				font-size: 1.2em;
				box-sizing:border-box;
			}

			input[type=file] {
				display:none;
			}

			#title{
				font-size: 4em;
			}

			#resultfield {
				border:1px solid white;
				height:100px;
				margin:40px 0px 0px 0px;
				width: 100%;
				padding:15px;
				color:#FFFFFF;
				text-align:left;
				box-sizing:border-box;
			}

			div#dateselector{
				padding-top: 10px;
				padding-bottom: 25px; 
				font-size: 1.2em;
			}

			input[type=button] {
				-moz-box-shadow:inset 0px 1px 0px 0px #7a8eb9;
				-webkit-box-shadow:inset 0px 1px 0px 0px #7a8eb9;
				box-shadow:inset 0px 1px 0px 0px #7a8eb9;
				background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #6075e1), color-stop(1, #1f3192));
				background:-moz-linear-gradient(top, #6075e1 5%, #1f3192 100%);
				background:-webkit-linear-gradient(top, #6075e1 5%, #1f3192 100%);
				background:-o-linear-gradient(top, #6075e1 5%, #1f3192 100%);
				background:-ms-linear-gradient(top, #6075e1 5%, #1f3192 100%);
				background:linear-gradient(to bottom, #6075e1 5%, #1f3192 100%);
				filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#637aad', endColorstr='#1f3192',GradientType=0);
				background-color:#637aad;
				border:1px solid #6075e1;
				display:inline-block;
				cursor:pointer;
				color:#ffffff;
				font-size:13px;
				font-weight:bold;
				text-decoration:none;
				margin:0px 0px;
				border-radius: 2px;
				padding:5px;
				width: 100%;
				font-size: 1.2em;
			}

			input[type=button]:active {
				position:relative;
				top:1px;
			}

			input[type=date]{
				font-size: 1.2em;
			}

			input:invalid+span:after {
 			 	content: '✖';
    			padding-left: 5px;
			}

			input:valid+span:after {
    			content: '✓';
    			padding-left: 5px;
		}
		</style>
	</head>

	<body>
		<div id="wrap">
			<div><span id="title"> CIO's <br/> ID Generator</span><hr></div>
			<input id="inputbar" value="" placeholder="Enter Name..." type="text">
			<div id="dateselector"> Please select date of birth: <input id="birthdatepicker" type="date" min="1918-01-01" max="2018-01-01" required></div>
			<input id="generateButton" type="button" value="Generate ID" />
			<div id="resultfield" style="display: block;"></div>
		</div>
	</body>
</html>